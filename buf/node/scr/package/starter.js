"use strict";var e=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var a=e(require("@babel/runtime/regenerator")),c=e(require("@babel/runtime/helpers/asyncToGenerator")),u=e(require("@babel/runtime/helpers/classCallCheck")),o=e(require("@babel/runtime/helpers/createClass")),i=e(require("@babel/runtime/helpers/inherits")),l=e(require("@babel/runtime/helpers/possibleConstructorReturn")),s=e(require("@babel/runtime/helpers/getPrototypeOf")),f=e(require("del")),p=e(require("gulp")),d=e(require("ora")),h=e(require("chalk")),b=require("../../utl/print"),t=e(require("../../exe/starter")),m=require("./common/task"),q=require("./common/check");function v(r){var n=y();return function(){var e,t=(0,s.default)(r);return t=n?(e=(0,s.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,t)}}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r=function(e){(0,i.default)(n,e);var t,r=v(n);function n(e){return(0,u.default)(this,n),r.call(this,e)}return(0,o.default)(n,[{key:"main",value:(t=(0,c.default)(a.default.mark(function e(){var t,r,n,c,u=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.default)(this.project.dist);case 2:return(0,b.printLoading)("checking project ".concat(this.project.name)),e.next=5,(0,q.precheck)(this.project);case 5:if(t=e.sent)return e.abrupt("return",(0,b.printExitError)(t));e.next=10;break;case 10:(0,b.printSuccess)("".concat(this.project.name," has no questions"));case 11:return console.log(),r=(0,d.default)("".concat(this.project.name," ").concat(h.default.blue("building"))).start(),e.prev=13,e.next=16,(0,m.compile)(this.project);case 16:n=e.sent,r.succeed("".concat(this.project.name," built ").concat(h.default.blue("successfully"),", total ").concat(h.default.green(n+"ms"))),e.next=24;break;case 20:return e.prev=20,e.t0=e.catch(13),r.fail("".concat(this.project.name," built ").concat(h.default.red("failed"))),e.abrupt("return",console.error(e.t0));case 24:return n=function(t,e){var r,n,e=e.isDirectory()?"folder":e.isFile()?"file":"";e&&(n=(0,d.default)("".concat(r=e+" src/"+t," ").concat(h.default.blue("rebuilding"))).start(),(0,m.compile)(u.project,function(e){return e.path.includes(t)}).then(function(e){n.succeed("".concat(r," rebuilt ").concat(h.default.blue("successfully"),", total ").concat(h.default.green(e+"ms")))}).catch(function(e){n.fail("".concat(r," rebuilt ").concat(h.default.red("failed"))),console.error(e)}))},(c=p.default.watch("**/*",{cwd:this.project.src})).on("addDir",n),c.on("change",n),e.abrupt("return",new Promise(function(e){u.on("close",function(){c.close(),e()})}));case 29:case"end":return e.stop()}},e,this,[[13,20]])})),function(){return t.apply(this,arguments)})}]),n}(t.default);exports.default=r;