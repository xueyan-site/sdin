"use strict";var e=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var c=e(require("@babel/runtime/regenerator")),a=e(require("@babel/runtime/helpers/asyncToGenerator")),o=e(require("@babel/runtime/helpers/classCallCheck")),i=e(require("@babel/runtime/helpers/createClass")),s=e(require("@babel/runtime/helpers/inherits")),u=e(require("@babel/runtime/helpers/possibleConstructorReturn")),l=e(require("@babel/runtime/helpers/getPrototypeOf")),f=e(require("del")),p=e(require("ora")),h=e(require("chalk")),t=e(require("../../../exe/builder")),d=require("../../../utl/print"),b=require("./webpack"),m=require("../common/task"),q=require("../common/check");function v(r){var n=x();return function(){var e,t=(0,l.default)(r);return t=n?(e=(0,l.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,u.default)(this,t)}}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r=function(e){(0,s.default)(u,e);var t,r,n=v(u);function u(e){return(0,o.default)(this,u),n.call(this,e)}return(0,i.default)(u,[{key:"main",value:(r=(0,a.default)(c.default.mark(function e(){var t,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.default)(this.project.dist);case 2:return e.next=4,(0,f.default)(this.project.withBuf("entry"));case 4:return(0,d.printLoading)("checking project ".concat(this.project.name)),e.next=7,(0,q.precheck)(this.project);case 7:if(r=e.sent)return e.abrupt("return",(0,d.printExitError)(r));e.next=12;break;case 12:(0,d.printSuccess)("".concat(this.project.name," has no questions"));case 13:return console.log(),t=(0,p.default)("".concat(this.project.name," ").concat(h.default.blue("building"))).start(),e.prev=15,e.next=18,(0,m.handleAssets)(this.project);case 18:return e.next=20,this.compile();case 20:r=e.sent,t.succeed("".concat(this.project.name," built ").concat(h.default.blue("successfully"))),r&&console.log(r.toString({all:!1,colors:!0,version:!0,timings:!0,builtAt:!0,assets:!0,children:!0,warnings:!0})),console.log(),e.next=30;break;case 26:return e.prev=26,e.t0=e.catch(15),t.fail("".concat(this.project.name," built ").concat(h.default.red("failed"))),e.abrupt("return",console.error(e.t0));case 30:case"end":return e.stop()}},e,this,[[15,26]])})),function(){return r.apply(this,arguments)})},{key:"compile",value:(t=(0,a.default)(c.default.mark(function e(){var t,u=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.createWebpack)(this.project);case 2:return t=e.sent,e.abrupt("return",new Promise(function(r,n){u.on("close",function(){t.close(function(){n("".concat(u.project.name," build process is closed"))})}),t.run(function(e,t){e?n(e):t&&t.hasErrors()?n(t.toString("errors-only")):r(t)})}));case 4:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),u}(t.default);exports.default=r;