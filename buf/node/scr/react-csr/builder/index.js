"use strict";var e=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var i=e(require("@babel/runtime/regenerator")),s=e(require("@babel/runtime/helpers/asyncToGenerator")),c=e(require("@babel/runtime/helpers/classCallCheck")),a=e(require("@babel/runtime/helpers/createClass")),o=e(require("@babel/runtime/helpers/inherits")),u=e(require("@babel/runtime/helpers/possibleConstructorReturn")),l=e(require("@babel/runtime/helpers/getPrototypeOf")),f=e(require("del")),t=e(require("../../../exe/builder")),p=require("../../../utl/print"),h=require("./webpack"),d=require("../common/assets");function b(r){var n=m();return function(){var e,t=(0,l.default)(r);return t=n?(e=(0,l.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,u.default)(this,t)}}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r=function(e){(0,o.default)(u,e);var t,r,n=b(u);function u(e){return(0,c.default)(this,u),n.call(this,e)}return(0,a.default)(u,[{key:"main",value:(r=(0,s.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.default)(this.project.dist);case 2:return e.next=4,(0,f.default)(this.project.withBuf("entry"));case 4:return(0,p.printLoading)("project ".concat(this.project.name," is being built")),e.next=7,(0,d.handleAssets)(this.project);case 7:return e.next=9,this.scriptTask();case 9:return e.abrupt("return",(0,p.printSuccess)("project ".concat(this.project.name," was built successfully")));case 10:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"scriptTask",value:(t=(0,s.default)(i.default.mark(function e(){var u,t,s=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=this.project,e.next=3,(0,h.createWebpack)(u);case 3:return t=e.sent,e.abrupt("return",new Promise(function(r,n){s.on("close",function(){t.close(function(){(0,p.printInfo)("project ".concat(u.name," build process is closed")),r()})}),t.run(function(e,t){e?((0,p.printError)(e),n()):t&&t.hasErrors()?((0,p.printError)(t.toString("errors-only")),n()):((0,p.printSuccess)("project ".concat(u.name," was built successfully!")),t&&console.log(t.toString({all:!1,colors:!0,version:!0,timings:!0,builtAt:!0,assets:!0,children:!0,warnings:!0})),r())})}));case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),u}(t.default);exports.default=r;