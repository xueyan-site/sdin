"use strict";var e=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var u=e(require("@babel/runtime/regenerator")),o=e(require("@babel/runtime/helpers/asyncToGenerator")),c=e(require("@babel/runtime/helpers/classCallCheck")),i=e(require("@babel/runtime/helpers/createClass")),a=e(require("@babel/runtime/helpers/inherits")),l=e(require("@babel/runtime/helpers/possibleConstructorReturn")),s=e(require("@babel/runtime/helpers/getPrototypeOf")),t=e(require("events")),f=e(require("fs-extra")),d=e(require("ora")),h=e(require("chalk")),p=require("../utl/exec");function v(r){var n=b();return function(){var e,t=(0,s.default)(r);return t=n?(e=(0,s.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,t)}}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r=function(e){(0,a.default)(n,e);var t,r=v(n);function n(e){var t;return(0,c.default)(this,n),(t=r.call(this)).project=e.project,t.executing=!1,t}return(0,i.default)(n,[{key:"race",value:function(e){var t=this;return Promise.race([e,new Promise(function(e){t.on("close",function(){e(void 0)})})])}},{key:"open",value:(t=(0,o.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.executing){e.next=15;break}return e.prev=1,this.executing=!0,this.emit("open"),e.next=6,this.race(this.main());case 6:this.executing=!1,this.removeAllListeners("close"),e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(1),this.executing=!1,this.removeAllListeners("close"),e.t0;case 15:case"end":return e.stop()}},e,this,[[1,10]])})),function(){return t.apply(this,arguments)})},{key:"close",value:function(){this.executing&&(this.emit("close"),this.executing=!1,this.removeAllListeners("close"))}},{key:"downloadModules",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.project.root,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.project.name;if(f.default.existsSync(e)){var r=(0,d.default)("".concat(t," node modules ").concat(h.default.blue("downloading"))).start();try{(0,p.executeSync)("cd ".concat(e," && yarn")),r.succeed("".concat(t," node modules ").concat(h.default.blue("downloaded successfully")))}catch(e){r.fail("".concat(t," node modules ").concat(h.default.red("download failed"))),console.error(e)}}}}]),n}(t.default);exports.default=r;