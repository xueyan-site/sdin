#!/usr/bin/env node
"use strict";var e=require("@babel/runtime/helpers/interopRequireDefault"),i=require("@babel/runtime/helpers/typeof"),p=e(require("@babel/runtime/regenerator")),t=e(require("@babel/runtime/helpers/asyncToGenerator")),r=e(require("chalk")),n=require("commander"),s=require("enquirer"),l=e(require("validator")),m=require("../utl/path"),a=require("../utl/print"),f=require("../utl/read"),d=o(require("../pro/package")),y=o(require("../pro/react-csr")),h=require("../scr/package"),g=require("../scr/react-csr");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var r,n,a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=o?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(a,r,n):a[r]=e[r]);return a.default=e,t&&t.set(e,a),a}process.env.XT_CMD="create",process.on("unhandledRejection",function(e){return(0,a.printExitError)(e)}),process.on("uncaughtException",function(e){return(0,a.printExitError)(e,1)}),(0,a.printInfo)("welcome to use ".concat(r.default.blue("xueyan-typescript-cli"))),(0,a.printInfo)("project creation process is ready"),console.log();var c=new n.Command;function q(e){return w.apply(this,arguments)}function w(){return(w=(0,t.default)(p.default.mark(function e(t){var r,n,a,o,i,u,c;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,f.readJsonSync)((0,m.cmdPath)("tmp/meta.json")),r=r.projects||[],e.next=4,(0,s.prompt)([{type:"select",name:"projectName",message:"what kind of project do you want to create",required:!0,choices:r.map(function(e){return{name:e.type,message:e.label}})}]);case 4:if(i=e.sent,n=i.projectName,o=r.find(function(e){return e.type===n}),a=o.type,process.env.XT_TYPE=a,i=o.templates,o=1===i.length?i[0].name:""){e.next=15;break}return e.next=14,(0,s.prompt)([{type:"select",name:"type",message:"which project template do you want to use",required:!0,choices:i.map(function(e){return{name:e.name,message:e.label}})}]);case 14:o=e.sent.template;case 15:return i=(0,f.readGitConfigSync)(),e.next=18,(0,s.prompt)([{type:"input",name:"name",message:"what is the name of your project",required:!0,validate:function(e){return/^[a-z@][a-z0-9\.\/\_\-]+$/.test(e)}},{type:"input",name:"root",message:"where do you want the project to be generated",required:!0,initial:function(e){e=e.state.answers.name||"";return(0,m.cwdPath)(t||"",e.replace("/","_"))}},{type:"input",name:"author",message:"please tell me the name of the author",required:!0,initial:i.user.name},{type:"input",name:"email",message:"please tell me the author's email",required:!0,initial:i.user.email,validate:l.default.isEmail}]);case 18:if(u=e.sent,console.log(),process.env.XT_PATH=u.root,(u={type:a,root:u.root,package:{name:u.name,version:"1.0.0",author:"".concat(u.author," <").concat(u.email,">")}}).type===d.PACKAGE_TYPE?c=new h.PackageCreator({project:new d.default(u),template:o}):u.type===y.REACT_CSR_TYPE&&(c=new g.ReactCSRCreator({project:new y.default(u),template:o})),c)return e.next=26,c.open();e.next=28;break;case 26:e.next=29;break;case 28:throw Error("sorry, there are no items of type ".concat(u.type));case 29:case"end":return e.stop()}},e)}))).apply(this,arguments)}c.description("create project").arguments("[path]").action(q).parse(process.argv);