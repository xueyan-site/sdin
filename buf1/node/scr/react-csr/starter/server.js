"use strict";var e=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createServer=f;var i=e(require("@babel/runtime/regenerator")),r=e(require("@babel/runtime/helpers/asyncToGenerator")),u=e(require("koa")),a=e(require("koa-compose")),o=e(require("koa-router")),t=e(require("express-to-koa")),n=e(require("webpack-dev-middleware")),s=e(require("webpack-hot-middleware")),c=require("../common/server");function f(e,r){return p.apply(this,arguments)}function p(){return(p=(0,r.default)(i.default.mark(function e(t,n){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new u.default).use((0,c.webError)({project:t,reader:function(e,r){return l(e,r,t,n)}})),r.use((0,c.webStatic)({prefix:t.path,dist:t.astPub,extensions:["html","json"]})),r.use(h(t,n)),r.use(w(n)),r.use(b(t,n)),e.abrupt("return",r);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function l(e,r,t,n){return d.apply(this,arguments)}function d(){return(d=(0,r.default)(i.default.mark(function e(r,t,n,u){var a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.withDist("web",t.path+".html"),r.set("content-type","text/html"),e.next=4,new Promise(function(t,n){u.outputFileSystem.readFile(a,function(e,r){return e?n(e):t(r)})});case 4:r.body=e.sent;case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function h(e,r){return(0,t.default)((0,n.default)(r,{stats:"errors-warnings",publicPath:e.path}))}function w(e){return(0,t.default)((0,s.default)(e))}function b(t,n){var e=t.pageList,u=new o.default({prefix:t.path});e.forEach(function(r){u.get(r.path,function(e){return l(e,r,t,n)})});var r=t.getPage(t.index);return r&&u.get("/",function(e){return l(e,r,t,n)}),(0,a.default)([u.routes(),u.allowedMethods()])}