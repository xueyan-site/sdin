"use strict";var e=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.deepCopy=r,exports.getReplaceHandler=t;var o=e(require("@babel/runtime/regenerator")),a=e(require("@babel/runtime/helpers/asyncToGenerator")),c=e(require("fs-extra")),n=e(require("chardet")),u=require("lodash"),l=require("./path"),p=require("./read");function r(e,r,t,n,a){return i.apply(this,arguments)}function i(){return(i=(0,a.default)(o.default.mark(function e(r,u,i,t,f){var s,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=/^__(.*\.\w+)__$/,n=function(){var r=(0,a.default)(o.default.mark(function e(r){var t,n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.default.readFile(r.current);case 2:if(a=e.sent,t=a,i)return e.next=7,i(r,a);e.next=8;break;case 7:t=e.sent;case 8:return n="",(n=f?f(r,u):n)||(a=s.exec(r.name),n=a&&a[1]?(0,l.withPath)(u,r.offset,"../"+a[1]):r.offset?(0,l.withPath)(u,r.offset):u),e.next=13,c.default.outputFile(n,t);case 13:case"end":return e.stop()}},e)}));return function(e){return r.apply(this,arguments)}}(),e.next=4,(0,p.deepRead)(r,n,t);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function t(t){return function(e,r){return n.default.analyse(r).find(function(e){return"UTF-8"===e.name})?(0,u.template)(r.toString("utf8"),{interpolate:/<%=([\s\S]+?)%>/g})(t):r}}