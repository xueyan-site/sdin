#!/usr/bin/env node
"use strict";var e=require("@babel/runtime/helpers/interopRequireDefault"),o=require("@babel/runtime/helpers/typeof"),a=e(require("@babel/runtime/regenerator")),r=e(require("@babel/runtime/helpers/asyncToGenerator")),t=e(require("chalk")),n=require("commander"),u=require("../utl/print"),i=require("../utl/path"),c=require("../pro/project"),p=b(require("../pro/package")),s=b(require("../pro/react-csr")),l=require("../scr/package"),f=require("../scr/react-csr");function d(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(d=function(e){return e?t:r})(e)}function b(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};r=d(r);if(r&&r.has(e))return r.get(e);var t,n,a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&((n=u?Object.getOwnPropertyDescriptor(e,t):null)&&(n.get||n.set)?Object.defineProperty(a,t,n):a[t]=e[t]);return a.default=e,r&&r.set(e,a),a}process.env.XT_CMD="build",process.on("unhandledRejection",function(e){return(0,u.printExitError)(e)}),process.on("uncaughtException",function(e){return(0,u.printExitError)(e,1)}),(0,u.printInfo)("welcome to use ".concat(t.default.blue("xueyan-typescript-cli")));var h=new n.Command;function w(e){return y.apply(this,arguments)}function y(){return(y=(0,r.default)(a.default.mark(function e(r){var t,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,i.cwdPath)(r||""),process.env.XT_PATH=t,t=(0,c.readProjectMeta)(t),process.env.XT_TYPE=t.type,t.type===p.PACKAGE_TYPE?n=new l.PackageBuilder({project:new p.default(t)}):t.type===s.REACT_CSR_TYPE&&(n=new f.ReactCSRBuilder({project:new s.default(t)})),n)return e.next=8,n.open();e.next=10;break;case 8:e.next=11;break;case 10:throw Error("please indicates the type of project in config file");case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}h.description("build project to production line").arguments("[path]").option("-w, --watch","watch file change").action(w).parse(process.argv);