"use strict";var t=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.readProjectMeta=i,exports.default=void 0;var n=t(require("@babel/runtime/regenerator")),e=t(require("@babel/runtime/helpers/asyncToGenerator")),a=t(require("@babel/runtime/helpers/classCallCheck")),o=t(require("@babel/runtime/helpers/createClass")),s=require("../utl/path"),h=require("../utl/read");function i(t){var e=(0,h.readPackageInfoSync)(t),i=(0,h.readJsonSync)("project.js",t);return{type:i.type||"",root:t,config:i,package:e}}var r=function(){function i(t,e){(0,a.default)(this,i),this.type=t,this.root=e.root,this.buf=this.withRoot("buf"),this.src=this.withRoot("src"),this.pub=this.withRoot("pub"),this.doc=this.withRoot("doc"),this.mdl=this.withRoot("node_modules"),this.tsc=this.withRoot("tsconfig.json"),this.dist=this.withRoot("dist"),this.astDist=this.withDist("ast"),this.defDist=this.withDist("def"),this.webDist=this.withDist("web"),this.nodeDist=this.withDist("node");t=this.package=e.package||(0,h.readPackageInfoSync)(this.root),e=this.config=(0,h.readJsonSync)(e.config||"project.js",this.root);this.author=t.author,this.version=t.version,this.name=e.name||t.name,this.id=[this.type,t.name,this.version].join("_"),this.alias=e.alias}var r;return(0,o.default)(i,[{key:"withRoot",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return s.withPath.apply(void 0,[this.root].concat(e))}},{key:"withBuf",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return s.withPath.apply(void 0,[this.buf].concat(e))}},{key:"withSrc",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return s.withPath.apply(void 0,[this.src].concat(e))}},{key:"withPub",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return s.withPath.apply(void 0,[this.pub].concat(e))}},{key:"withDoc",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return s.withPath.apply(void 0,[this.doc].concat(e))}},{key:"withDist",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return s.withPath.apply(void 0,[this.dist].concat(e))}},{key:"withMdl",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return s.withPath.apply(void 0,[this.mdl].concat(e))}},{key:"getDepVersion",value:function(t){var e=this.package.dependencies;return e&&e[t]||""}},{key:"getTsconfig",value:function(){return this.__tsConfig__||(this.__tsConfig__=(0,h.readJsonSync)(this.tsc)),this.__tsConfig__}},{key:"getIrregularFileList",value:(r=(0,e.default)(n.default.mark(function t(e,i){var r,a;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=/^[a-z][a-z0-9\.]+$/,a=[],(0,h.deepRead)(e,function(t){r.test(t.name)||a.push(i?(0,s.joinPath)(i,t.offset):t.offset)}),t.abrupt("return",a);case 4:case"end":return t.stop()}},t)})),function(t,e){return r.apply(this,arguments)})}]),i}();exports.default=r;